# PentestWomcy
Material do Curso de Pentest disponibilizado pela Womcy

ICMP
Internet Control Message Protocol (ICMP)) uma rede de protocolo que é responsável por comunicar erros através dos meios de geração e envio de mensagens para o endereço IP de origem quando existem problemas de rede encontrados pelo sistema. Definido pelo RFC 792, é utilizado para comunicar informações da camada de rede, sendo o uso mais comum para fornecer relatórios de erros à fonte original. As mensagens que o ICMP gera indicam que um determinado gateway, roteador, serviço ou mesmo host que deveria se conectar à internet não pode ser alcançado. Basicamente, o destinatário não pode receber pacotes durante a transmissão. Qualquer dispositivo de rede IP pode enviar, gerar, receber e processar mensagens de erro ICMP.
Essencialmente, o ICMP desempenha o papel de mensageiro que transmite dados e informações do destinatário para o remetente.

TCP flags
SYN (synchronize): Pacotes que são suados para iniciar uma conexão

ACK (Reconhecimento): Pacotes usados para confirmar que os pacotes de dados foram recebidos;

RST (Reset): Conexão está baixa ou talvez os serviços não estejam aceitando conexões;

FIN (Finish): Conexão está sendo fechada. Tanto o remetente como o receptor enviam um um pacote FIN para terminar a conexão

PSH (Push): Indica que os dados devem ser repassados direto para o aplicatico em vez de serem bufferizados;

URG (Urgente): Indica que os dados recebidos, devem ser processados imediatamente pela pilha TCP

Cabeçalho UDP
O cabeçalho UDP é extremamente simples, contendo apenas os números de porta, comprimento da mensagem e o checksum. O cabeçalho dos datagramas UDP é colocado a seguir ao cabeçalho IP.

Vangagens do UDP
O UDP é uma escolha adequada para fluxos de dados em tempo real, especialmente aqueles que admitem perda ou corrompimento de parte de seu conteúdo, tais como vídeos ou voz (VoIP). Aplicações sensíveis a atrasos na rede, mas poucos sensíveis a perdas de pacotes, como jogos de computadores, também podem se utilizar do UDP. As garantias de TCP envolvem retransmissão e espera de dados, como consequência, intensificam os efeitos de uma alta latência de rede.

O UDP também suporta broadcasting e multicasting. Caso esses recursos sejam necessários, o UDP deverá necessariamente ser utilizado. Algum tratamento de erro pode ser adicionado, mas geralmente aplicações multicast também admitem perda de parte dos pacotes ou fazem retransmissões constantes (tal como o ocorre no protocolo DHCP)

O UDP não perde tempo com criação ou destruição de conexões. Durante uma conexão, o UDP troca apenas 2 pacotes, enquanto no TCP esse número é superior a 10. Por isso, aplicações que encaixam num modelo de pergunta-resposta também são fortes candidatas a usar UDP. Entretanto, pode ser necessário implementar algoritmos de timeouts, acks e, no mínimo, retransmissão. Nesse caso, vale lembrar que se a troca de mensagens for muito intensa, o protocolo TCP pode voltar a ser vantajoso, já que seu custo de conexão será amortizado.

Ping
ping é um utilitário que usa o protocolo ICMP para testar a conectividade entre equipamentos. É um comando disponível praticamente em todos os sistemas operacionais. Seu funcionamento consiste no envio de pacotes para o equipamento de destino e na "escuta" das respostas. Se o equipamento de destino estiver ativo, uma resposta é devolvida ao computador solicitante.

O ping é uma ferramenta simples, mas de muita utilizdade. Ele ajuda a diagnosticar problemas de conectividade entre ips, redes, internet.

O ping pode ser também utilizado com fins maliciosos, por exemplo em um ataque de negação de serviços (DDoS).

Outra ferramenta de rede que utiliza o ICMP de maneira semelhante é o Traceroute.

A saída do ping, o nome do equipamento "pingado", o número de seqüência do pacote ICMP, o tempo de vida e a latência, com todos os tempos dados em milissegundos.

Ping da Morte
O ping da morte (ping of death, em inglês) é um ataque que envolve o envio de um grande pacote de ping para uma máquina destino. Consiste em solicitações ping com um tamanho de pacote muito elevado e numa frequência também alta (milhares de vezes por segundo)

O ping da morte é um ataque de estouro de buffer em que o emissor envia um "ping" (literalmente, um pedido de eco ICMP) com uma grande sobrecarga no sistema destino. Um ping é geralmente 64 bytes de comprimento, enquanto que um ping de da morte é tão grande quando o máximo permitido que é 65.535 bytes. O alvo é frequentemente incapaz de processar o pacote adequadamente, resultando em um estouro de buffer causando o mau funcionamento do sistema TCP/IP. É também um ataque DoS porque impede o acesso ao sistema pelos usuários.

Exemplo de Ping da morte
ping -i 1 -l 65500 (ip de destino ou nome host) -t
Onde:

ping:
Comando própriamente dito

-i 1:
Intervalo entre cada ping. No caso 1 ms

-l 65500:
O tamanho do pacote em bytes.( Esse é o maior tamanho possível)

Alvo:
Alvo ou IP de destino

-t :
Envia requisição por tempo indeterminado ou até o usuário cancelar com (CONTROL +C)

NMAP
O que é nmap?
É uma ferramenta de segurança de código aberto para exploração, varredura, auditoria e segurança de rede. Tem muitas opções que o tornam uma ferramenta eficiênte para scan, enumeração e até mesmo levantamento de vulnerabilidades.

Cenário de lab:

Uma vm com Kali linux. IP: 192.168.10.130

Uma vm com metasploitable IP: 192.168.10.100

1 - Scan de um host (IPV4)
Diante dese cenário, vamos rodar o seguinte comando:

nmap 192.168.10.100


Ferramenta Responder

Como nós vimos na aula de ontem, quando você tem acesso a rede é possível "sniffar" o tráfego da rede. A manipulação dos pacotes capturados permite ataques do tipo Man-in-the-Middle.
Sabemos que muitos ataques são principalmente causados pelo fato de que mecanismos como ARP (Address Resolution Protocol), DHCP (Dynamic Host Configuration Protocol) e o DNS (Domain Name System) não estão configurados corretamente. 
Mas acontece que a própria arquitetura possui falhas que podem ser exploradas. Por exemplo, um ataque LLMNR & NBT-NS Poisoning funciona muitas vezes porque esses protocolos são habilitados por padrão em ambientes windows.

Tendo acesso a rede, é possível iniciar o responder.py. O Responder é uma ferramenta para envenenamento dos protocolos LLMNR, NBT-NS e MDNS. Ele irá responder às consultas do NBT-NS (NetBIOS Name Service) com base em seu sufixo de nome. Por padrão, a ferramenta apenas responderá a pedidos do serviço de arquivos que forem para o protocolo SMB. 

Algumas funcionalidades chaves do Responder são:
Servidor de autenticação SMB incorporado – Suporta hashes NTLMv1 e NTLMv2 com Extended Security NTLMSSP por padrão. Testado com sucesso desde o Windows 95 até o Server 2012 RC, Samba e Mac OSX Lion. O downgrade de hash LM é suportado utilizando o parâmetro –lm. Esse modo é ativado por padrão quando a ferramenta é iniciada.

Servidor de Autenticação MSSQL incorporado – Redireciona a autenticação SQL para a ferramenta que simula um servidor SQL. Para utilizar essa funcionalidade utilize o parâmetro -r. Este modo suporta hashes NTLMv1 e LMv2.

Servidor de autenticação HTTP incorporado – Para redirecionar a Autenticação HTTP para a ferramenta você precisa utilizar o parâmetro -r. Este modo suporta hashes NTLMv1, NTLMv2 e Basic Authentication.

Servidor de autenticação FTP, POP3, IMAP e SMTP incorporado – Esses módulos coletarão credenciais em texto claro na rede.

Servidor Proxy WPAD incorporado – Este módulo irá capturar todas as solicitações HTTP de qualquer pessoa que inicie o browser na rede com a opção “Detectar Automaticamente as Configurações”. Este módulo é altamente eficaz, você pode configurar seu script PAC personalizado no Responder.conf e injetar um HTML nas respostas do servidor.

Browser Listener – Este módulo permite encontrar o PDC de forma stealth.

Fingerprinting – Quando a opção -f é usada, o Responder irá fazer um fingerprint de todos os hosts que realizaram uma consulta LLMNR / NBT-NS.

Modo de análise – Este módulo permite que você veja consultas NBT-NS, BROWSER, LLMNR e DNS na rede sem envenenar qualquer resposta. Além disso, você pode mapear os domínios, servidores em geral e as estações de trabalho de forma passiva.

Para conhecer mais sobre a ferramenta e suas funcionalidades acesse:

https://github.com/SpiderLabs/Responder

https://github.com/lgandx/Responder
